<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LÃ©o OS</title>
  <meta name="theme-color" content="#0B1220" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#0B1220;--panel:#0F1A33;--card:#111F3D;--text:#EAF0FF;--muted:#A8B3D6;
      --accent:#7C5CFF;--accent2:#22C55E;--warn:#F59E0B;--danger:#EF4444;--border:rgba(255,255,255,.08);
      --shadow:0 18px 45px rgba(0,0,0,.35);--r:18px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      --ui:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--ui);color:var(--text);background:radial-gradient(1200px 700px at 20% 0%,rgba(124,92,255,.25),transparent 60%),radial-gradient(900px 600px at 90% 10%,rgba(34,197,94,.18),transparent 55%),radial-gradient(900px 600px at 40% 100%,rgba(245,158,11,.12),transparent 55%),var(--bg);min-height:100vh}
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 26px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px;border:1px solid var(--border);border-radius:var(--r);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));box-shadow:var(--shadow);position:sticky;top:10px;backdrop-filter:blur(10px)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:14px;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.20),transparent 55%),linear-gradient(135deg,rgba(124,92,255,.9),rgba(34,197,94,.55));border:1px solid var(--border);box-shadow:0 10px 28px rgba(124,92,255,.25);position:relative;overflow:hidden}
    .logo:after{content:"";position:absolute;inset:-40%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.22),transparent);transform:rotate(25deg);animation:shine 4.8s ease-in-out infinite}
    @keyframes shine{0%,55%{transform:translateX(-35%) rotate(25deg)}70%,100%{transform:translateX(35%) rotate(25deg)}}
    .title{display:flex;flex-direction:column;line-height:1.1}
    .title b{font-size:16px;letter-spacing:.2px}
    .title span{font-size:12px;color:var(--muted)}
    .chip{font-family:var(--mono);font-size:12px;color:rgba(255,255,255,.88);padding:8px 10px;border:1px solid var(--border);border-radius:999px;background:rgba(15,26,51,.55);display:flex;align-items:center;gap:8px}
    .dot{width:8px;height:8px;border-radius:99px;background:var(--accent2);box-shadow:0 0 0 6px rgba(34,197,94,.12)}
    .grid{display:grid;gap:12px;margin-top:14px}
    @media(min-width:840px){.grid{grid-template-columns:1.2fr .8fr}}
    .panel{border:1px solid var(--border);border-radius:var(--r);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));box-shadow:var(--shadow);padding:14px}
    .panel h2{margin:0 0 10px;font-size:14px;color:rgba(234,240,255,.92);letter-spacing:.3px}
    .cards{display:grid;gap:10px}
    @media(min-width:840px){.cards{grid-template-columns:repeat(2,1fr)}}
    .card{border:1px solid var(--border);border-radius:16px;padding:12px;background:radial-gradient(700px 220px at 0% 0%,rgba(124,92,255,.16),transparent 55%),radial-gradient(500px 220px at 100% 0%,rgba(34,197,94,.12),transparent 55%),rgba(17,31,61,.70);transition:transform .12s ease,border-color .12s ease,opacity .1s ease;cursor:pointer}
    .card:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.14)}
    .card:active{opacity:.75;transform:scale(.98)}
    .card .k{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .tag{font-size:12px;color:rgba(255,255,255,.85);padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(0,0,0,.18)}
    .card h3{margin:10px 0 4px;font-size:16px}
    .card p{margin:0;color:var(--muted);font-size:13px}
    .nav{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .btn{border:1px solid var(--border);background:rgba(15,26,51,.6);color:var(--text);padding:10px 12px;border-radius:14px;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:transform .10s ease,border-color .10s ease,background .10s ease,opacity .1s ease;user-select:none}
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.16);background:rgba(15,26,51,.78)}
    .btn:active{opacity:.75;transform:scale(.97)}
    .btn.primary{background:linear-gradient(135deg,rgba(124,92,255,.85),rgba(124,92,255,.40));border-color:rgba(124,92,255,.35)}
    .btn.good{background:linear-gradient(135deg,rgba(34,197,94,.75),rgba(34,197,94,.30));border-color:rgba(34,197,94,.30)}
    .btn.warn{background:linear-gradient(135deg,rgba(245,158,11,.75),rgba(245,158,11,.28));border-color:rgba(245,158,11,.30)}
    .btn.danger{background:linear-gradient(135deg,rgba(239,68,68,.70),rgba(239,68,68,.25));border-color:rgba(239,68,68,.28)}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.4}
    .list{margin-top:10px;display:grid;gap:8px}
    .row{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;padding:10px;border-radius:14px;border:1px solid var(--border);background:rgba(17,31,61,.55)}
    .row b{font-size:13px}
    .row span{display:block;font-size:12px;color:var(--muted);margin-top:2px}
    .badge{font-family:var(--mono);font-size:11px;padding:6px 8px;border-radius:999px;border:1px solid var(--border);color:rgba(255,255,255,.9);background:rgba(0,0,0,.18);white-space:nowrap}
    .footer{margin-top:14px;padding:12px;border-radius:var(--r);border:1px dashed rgba(255,255,255,.14);color:var(--muted);font-size:12px;background:rgba(15,26,51,.35)}
    code{font-family:var(--mono);font-size:12px}
    #toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(60px);background:rgba(17,31,61,.95);border:1px solid rgba(124,92,255,.4);color:var(--text);padding:10px 18px;border-radius:999px;font-size:13px;z-index:999;backdrop-filter:blur(10px);transition:transform .25s cubic-bezier(.34,1.56,.64,1),opacity .25s;opacity:0;pointer-events:none;white-space:nowrap;box-shadow:0 8px 24px rgba(0,0,0,.4)}
    #toast.show{transform:translateX(-50%) translateY(0);opacity:1}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <b>LÃ©o OS</b>
          <span>Mini App â€” Dashboard & modules</span>
        </div>
      </div>
      <div class="chip">
        <span class="dot"></span>
        <span id="modeChip">mode: <code>today</code></span>
      </div>
    </div>

    <div class="grid">
      <section class="panel">
        <h2>Dashboard</h2>
        <div class="cards" id="cards"></div>
        <div class="nav">
          <div class="btn primary" onclick="go('today')">ğŸ  Aujourd'hui</div>
          <div class="btn"         onclick="go('admin')">ğŸ“‚ Admin</div>
          <div class="btn"         onclick="go('projects')">ğŸ§© Projets</div>
          <div class="btn"         onclick="go('content')">âœï¸ Contenu</div>
          <div class="btn good"    onclick="go('coach')">ğŸ‹ï¸ Coach</div>
        </div>
        <div class="small" id="hint"></div>
      </section>

      <aside class="panel">
        <h2>Actions rapides</h2>
        <div class="list" id="actions"></div>
        <div class="footer">
          <b>Comment Ã§a marche</b><br>
          Les boutons envoient un message texte Ã  LÃ©o via l'API Telegram Bot.
          LÃ©o reÃ§oit via OpenClaw (long-polling) et rÃ©pond dans le chat â€” sans fermer cette app.
        </div>
      </aside>
    </div>
  </div>

  <div id="toast">ğŸ¦ Message envoyÃ© Ã  LÃ©o</div>

  <script>
    // â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Remplace par le token de @leo_horizons_bot et ton chat_id (8572640484)
    // Ce fichier doit rester privÃ© (servi uniquement sur ton rÃ©seau ou VPS sÃ©curisÃ©)
    const BOT_TOKEN ='7605504922:AAFF1wsP-pl4AQZ0hXPyrwGpHboBCk4NBs8';
    const CHAT_ID   = '8572640484';

    // â”€â”€â”€ SDK Telegram â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;

    if (tg) {
      tg.ready();
      tg.expand();
      try { tg.setHeaderColor('#0B1220'); }     catch(e){}
      try { tg.setBackgroundColor('#0B1220'); } catch(e){}
    }

    function getStartParam() {
      if (tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param) return tg.initDataUnsafe.start_param;
      const u = new URL(window.location.href);
      return u.searchParams.get('tgWebAppStartParam') || u.searchParams.get('startapp') || 'today';
    }

    let currentMode = 'today';

    // â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let toastTimer;
    function showToast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => el.classList.remove('show'), 2400);
    }

    // â”€â”€â”€ Envoi du message Ã  LÃ©o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // On n'utilise PAS tg.sendData() car :
    //   1) sendData() ferme la Mini App immÃ©diatement
    //   2) sendData() ne fonctionne qu'avec un KeyboardButton "web_app",
    //      pas avec un lien d'ouverture direct comme le fait OpenClaw
    //
    // On appelle directement l'API Bot Telegram â†’ sendMessage â†’ LÃ©o reÃ§oit
    // le message comme si tu l'avais tapÃ©, rÃ©pond dans le chat, Mini App reste ouverte.
    async function send(action, label) {
      if (tg) { try { tg.HapticFeedback.impactOccurred('light'); } catch(e){} }

      const texte = buildMessage(action, currentMode);

      if (!tg || !tg.initData) {
        console.log('[LÃ©o OS â€” hors Telegram]', texte);
        showToast('ğŸ§ª Hors Telegram â€” console');
        return;
      }

      try {
        const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: CHAT_ID, text: texte }),
        });
        const data = await resp.json();
        if (data.ok) {
          showToast('ğŸ¦ LÃ©o reÃ§oit : ' + (label || action));
        } else {
          showToast('âš ï¸ ' + (data.description || 'Erreur API'));
          console.warn('[LÃ©o OS]', data);
        }
      } catch(err) {
        showToast('âŒ Connexion impossible');
        console.error('[LÃ©o OS]', err);
      }
    }

    // â”€â”€â”€ Traduction action â†’ commande courte pour Leo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Commandes courtes sans apostrophes ni caracteres speciaux
    // pour eviter tout probleme d'interpretation Telegram
    function buildMessage(action) {
      const map = {
        today_plan:        "/plan_jour",
        today_deadlines:   "/agenda_7j",
        coach_today:       "/seance_jour",
        content_one:       "/post_jour",
        admin_checklist:   "/checklist_admin",
        admin_energy:      "/echeances_energie",
        admin_letter:      "/generer_courrier",
        admin_log:         "/log_notion",
        projects_list:     "/liste_projets",
        projects_run:      "/mode_execution",
        projects_arbitrate:"/arbitrage",
        projects_blockers: "/blocages",
        content_linkedin:  "/post_linkedin",
        content_seo:       "/plan_seo",
        content_repurpose: "/recycler_contenu",
        content_schedule:  "/programmer_contenu",
        coach_checkin:     "/checkin",
        coach_workout:     "/entrainement",
        coach_nutrition:   "/nutrition",
        coach_weekly:      "/bilan_hebdo",
      };
      return map[action] || action;
    }

    // â”€â”€â”€ DonnÃ©es â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const cardsByMode = {
      today:    [{tag:'Focus',title:'Top 3 prioritÃ©s',desc:'1 admin, 1 projet, 1 santÃ© (max).',action:'today_plan'},{tag:'Ã‰chÃ©ances',title:'Ã€ ne pas rater',desc:'RÃ©cap agenda + deadlines.',action:'today_deadlines'},{tag:'Coach',title:'SÃ©ance du jour',desc:'Plan minimal viable + objectif.',action:'coach_today'},{tag:'Contenu',title:'1 post prÃªt',desc:'IdÃ©e + brouillon LinkedIn ou blog.',action:'content_one'}],
      admin:    [{tag:'CAF/Assurance',title:'Checklist documents',desc:'Liste claire + prochaine action.',action:'admin_checklist'},{tag:'Factures',title:'Ã‰chÃ©ances Ã©nergie',desc:'Ce qui arrive + prÃ©parer paiement.',action:'admin_energy'},{tag:'Courriers',title:'GÃ©nÃ©rer un courrier',desc:'ModÃ¨le + validation avant envoi.',action:'admin_letter'},{tag:'Journal',title:'Trace des actions',desc:'Log Notion (audit).',action:'admin_log'}],
      projects: [{tag:'H1/H2',title:'Vue Projets',desc:'Liste + statut + prochaine Ã©tape.',action:'projects_list'},{tag:'Workflow',title:'Mode exÃ©cution',desc:'Ã‰tapes une par une, tu rÃ©ponds "ok".',action:'projects_run'},{tag:'DÃ©cision',title:'Arbitrage',desc:'Choisir objectivement.',action:'projects_arbitrate'},{tag:'Risque',title:'Blocages',desc:'Freins + solution minimaliste.',action:'projects_blockers'}],
      content:  [{tag:'LinkedIn',title:'Post prÃªt Ã  publier',desc:'Hook + structure + ton pro.',action:'content_linkedin'},{tag:'SEO',title:"Plan d'article",desc:'H1/H2 + mots-clÃ©s + maillage.',action:'content_seo'},{tag:'Repurpose',title:'Recycler',desc:'1 idÃ©e â†’ 3 formats.',action:'content_repurpose'},{tag:'Calendrier',title:'Programmer',desc:'CrÃ©er un Ã©vÃ©nement Ã©ditorial.',action:'content_schedule'}],
      coach:    [{tag:'Check-in',title:'Point rapide',desc:'Poids, sommeil, faim, Ã©nergie.',action:'coach_checkin'},{tag:'Sport',title:'SÃ©ance',desc:'Plan du jour + alternative courte.',action:'coach_workout'},{tag:'Nutrition',title:'Cible calories',desc:'Suggestion simple + repas type.',action:'coach_nutrition'},{tag:'Bilan',title:'Hebdo',desc:'Tendance + ajustements.',action:'coach_weekly'}],
    };
    const actionsByMode = {
      today:    [{label:'ğŸ“Œ GÃ©nÃ©rer mon plan du jour',kind:'primary',action:'today_plan'},{label:'ğŸ“… RÃ©cap agenda (7 jours)',kind:'',action:'today_deadlines'},{label:'ğŸ‹ï¸ SÃ©ance du jour',kind:'good',action:'coach_today'},{label:'âœï¸ 1 post LinkedIn',kind:'',action:'content_linkedin'}],
      admin:    [{label:'ğŸ§¾ Checklist admin',kind:'primary',action:'admin_checklist'},{label:'ğŸ’¡ Ã‰chÃ©ances Ã©nergie',kind:'warn',action:'admin_energy'},{label:'âœ‰ï¸ GÃ©nÃ©rer courrier',kind:'',action:'admin_letter'},{label:'ğŸ§  Log action Notion',kind:'',action:'admin_log'}],
      projects: [{label:'ğŸ§© Liste projets',kind:'primary',action:'projects_list'},{label:'â–¶ï¸ Lancer workflow',kind:'good',action:'projects_run'},{label:'âš–ï¸ Arbitrage',kind:'warn',action:'projects_arbitrate'},{label:'ğŸ§¯ Blocages',kind:'danger',action:'projects_blockers'}],
      content:  [{label:'ğŸ“ Post LinkedIn',kind:'primary',action:'content_linkedin'},{label:'ğŸ” Plan SEO',kind:'',action:'content_seo'},{label:'â™»ï¸ Recycler',kind:'',action:'content_repurpose'},{label:'ğŸ“… Programmer',kind:'good',action:'content_schedule'}],
      coach:    [{label:'âœ… Check-in 30s',kind:'primary',action:'coach_checkin'},{label:'ğŸ‹ï¸ EntraÃ®nement',kind:'good',action:'coach_workout'},{label:'ğŸ¥— Nutrition',kind:'',action:'coach_nutrition'},{label:'ğŸ“ˆ Bilan hebdo',kind:'warn',action:'coach_weekly'}],
    };

    // â”€â”€â”€ Rendu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render(mode) {
      currentMode = mode;
      document.getElementById('modeChip').innerHTML = 'mode: <code>' + mode + '</code>';

      const cards = cardsByMode[mode] || cardsByMode.today;
      document.getElementById('cards').innerHTML = cards.map(c =>
        '<div class="card" onclick=\'send("' + c.action + '","' + c.title + '")\'>' +
        '<div class="k"><span class="tag">' + c.tag + '</span><span class="badge">' + mode + '</span></div>' +
        '<h3>' + c.title + '</h3><p>' + c.desc + '</p></div>'
      ).join('');

      const acts = actionsByMode[mode] || actionsByMode.today;
      document.getElementById('actions').innerHTML = acts.map(a =>
        '<div class="row"><div><b>' + a.label + '</b><span>â†’ LÃ©o reÃ§oit et rÃ©pond dans le chat</span></div>' +
        '<div class="btn ' + a.kind + '" onclick=\'send("' + a.action + '","' + a.label + '")\'>Lancer</div></div>'
      ).join('');

      document.getElementById('hint').innerHTML =
        'Astuce : ouvre ce module avec <code>startapp=' + mode + '</code> dans l\'URL du bot.';
    }

    function go(mode) { render(mode); }

    render(getStartParam());
  </script>
</body>
</html>
